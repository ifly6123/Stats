<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module 1: Data Playground</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jstat@latest/dist/jstat.min.js"></script>
</head>
<body>

    <nav class="breadcrumb">
        <a href="index.html">Home</a> &gt; <span>Module 1</span>
    </nav>

    <header class="module-header">
        <h1 class="gradient-text-blue">Module 1: The Data Playground</h1>
        <p>Explore basic descriptive statistics and probability through interaction and simulation.</p>
    </header>

    <div class="tab-nav" id="module-1-tabs">
        <button class="tab-link active" data-tab="tab-playground">Playground</button>
        <button class="tab-link" data-tab="tab-simulations">Simulations</button>
        <button class="tab-link" data-tab="tab-concepts">Concepts</button>
    </div>

    <main class="content-wrapper">

        <div id="tab-playground" class="tab-content active">
            <div class="viz-container-large" id="playground-container">
                {/* New Intro Text */}
                <p class="intro-text">Click the chart below to add random data points (from a normal distribution centered around 50). Watch how the histogram shape and statistics change with each click.</p>
                <div id="histogram-plot"></div>
            </div>
            <div class="controls-container">
                <h2>Live Statistics</h2>
                <p>These values update as you add data.</p>
                <div class="stats-box" id="playground-stats">
                    <div class="stat"><strong>Count (n):</strong> <span id="stat-count">0</span></div>
                    <div class="stat"><strong>Mean:</strong> <span id="stat-mean">N/A</span></div>
                    <div class="stat"><strong>Mean Abs. Dev (MAD):</strong> <span id="stat-mad">N/A</span></div>
                    <div class="stat"><strong>Std. Dev (s):</strong> <span id="stat-stddev">N/A</span></div>
                    <div class="stat"><strong>Std. Error (SE):</strong> <span id="stat-stderr">N/A</span></div>
                    <div class="stat"><strong>Coeff. Variation (CV):</strong> <span id="stat-cv">N/A</span></div>
                </div>
                <button id="reset-playground-btn" class="btn-danger">Clear Data</button>
            </div>
        </div>

        <div id="tab-simulations" class="tab-content">
            <div class="viz-container-large" id="simulation-container">
                <h3>Simulation Output</h3>
                <div id="simulation-plot"></div>
                <div id="simulation-data-display">Your generated data will appear here...</div>
            </div>
            <div class="controls-container">
                <h2>Run Simulations</h2>
                <p>Generate data from common random events.</p>
                <div class="control-group">
                    <label for="sim-select">Select Simulation:</label>
                    <select id="sim-select">
                        <option value="coin">Flip Coin</option>
                        <option value="die">Roll Die (6-sided)</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="sim-n">Number of Trials (n):</label>
                    <input type="number" id="sim-n" value="20" min="10" max="1000">
                </div>
                <button id="run-simulation-btn" class="btn-primary">Run Simulation</button>
                <div class="stats-box" id="simulation-stats">
                    <h4>Results:</h4>
                    <div class="stat"><strong>Count (n):</strong> <span id="sim-stat-count">0</span></div>
                    <div class="stat"><strong>Mean:</strong> <span id="sim-stat-mean">N/A</span></div>
                    <div class="stat"><strong>Std. Dev (s):</strong> <span id="sim-stat-stddev">N/A</span></div>
                </div>
            </div>
        </div>

        <div id="tab-concepts" class="tab-content">
            <div class="concept-container"><h2>Key Concepts</h2><h3>What is Descriptive Statistics?</h3><p>Descriptive statistics are used to <strong>summarize and describe</strong> the main features of a collection of data. They don't try to make inferences about a larger population, but simply give you a snapshot of the data you have.</p><h3>Visualizing Data: The Frequency Distribution (Histogram)</h3><p>A <strong>frequency distribution</strong> shows how often each different value (or range of values) appears in your dataset. The <strong>histogram</strong> is a common way to visualize this, using bars where the height represents the frequency.</p><h3>Measures of Central Tendency (The "Middle")</h3><ul><li><strong>Mean:</strong> The average value (sum of all values divided by the count). Sensitive to outliers.</li><li><strong>Median:</strong> The middle value when the data is sorted. Not sensitive to outliers.</li><li><strong>Mode:</strong> The value that appears most frequently.</li></ul><h3>Measures of Dispersion (The "Spread")</h3><ul><li><strong>Variance ($s^2$):</strong> The average squared difference of each value from the mean.</li><li><strong>Standard Deviation ($s$):</strong> The square root of the variance. It tells you the typical amount that values deviate from the mean, in the original units of the data.</li><li><strong>Mean Absolute Deviation (MAD):</strong> The average of the absolute differences between each value and the mean: $\frac{\sum |x_i - \bar{x}|}{n}$. Like standard deviation, it measures spread, but it's less sensitive to extreme outliers because it doesn't square the deviations.</li><li><strong>Standard Error (SE or SEM):</strong> $SE = s / \sqrt{n}$. This measures how much the <em>sample mean</em> is likely to vary from the true <em>population mean</em>. It gets smaller as your sample size ($n$) increases.</li><li><strong>Coefficient of Variation (CV):</strong> $CV = (s / \bar{x}) * 100\%$. This is a <em>relative</em> measure of spread, expressed as a percentage. It's useful for comparing the variability of datasets with different units or different means.</li></ul></div>
        </div>

    </main>

    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/contrib/auto-render.min.js"></script>
    <script>document.addEventListener("DOMContentLoaded", function () { renderMathInElement(document.body, { delimiters: [{ left: "$", right: "$", display: false }] }); });</script>

    <script>
        /* ========================================================= */
        /* ★ MODULE 1: DATA PLAYGROUND LOGIC ★                       */
        /* ========================================================= */

        const module1Tabs = d3.selectAll("#module-1-tabs .tab-link");
        const module1Contents = d3.selectAll(".content-wrapper > .tab-content");
        module1Tabs.on("click", function () { const tabId = d3.select(this).attr("data-tab"); module1Tabs.classed("active", false); d3.select(this).classed("active", true); module1Contents.classed("active", false); d3.select("#" + tabId).classed("active", true); });

        (function setupPlayground() {
            const margin = { top: 20, right: 20, bottom: 40, left: 40 };
            const width = 600 - margin.left - margin.right;
            const height = 350 - margin.top - margin.bottom;
            let playgroundData = [];

            const svg = d3.select("#histogram-plot").append("svg")
                .attr("width", "100%").attr("height", height + margin.top + margin.bottom)
                .attr("viewBox", `0 0 ${width + margin.left + margin.right} ${height + margin.top + margin.bottom}`)
                .attr("preserveAspectRatio", "xMidYMid meet")
                .append("g").attr("transform", `translate(${margin.left}, ${margin.top})`);

            const xScale = d3.scaleLinear().domain([0, 100]).range([0, width]);
            const xAxis = svg.append("g").attr("transform", `translate(0, ${height})`).call(d3.axisBottom(xScale));

            const yScale = d3.scaleLinear().range([height, 0]);
            const yAxis = svg.append("g");
            const barGroup = svg.append("g").attr("class", "bars");
            const annotationGroup = svg.append("g").attr("class", "annotations");

            svg.append("rect").attr("width", width).attr("height", height).style("fill", "none").style("pointer-events", "all")
                .on("click", (event) => { const newValue = Math.max(0, Math.min(100, d3.randomNormal(50, 15)())); playgroundData.push(newValue); updatePlayground(); });

            d3.select("#reset-playground-btn").on("click", () => { playgroundData = []; updatePlayground(); });

            function updatePlayground() {
                const n = playgroundData.length;
                d3.select("#stat-count").text(n);
                annotationGroup.html("");

                if (n === 0) {
                    d3.select("#stat-mean").text("N/A"); d3.select("#stat-mad").text("N/A"); d3.select("#stat-stddev").text("N/A");
                    d3.select("#stat-stderr").text("N/A"); d3.select("#stat-cv").text("N/A");
                    barGroup.selectAll(".bar").remove();
                    yScale.domain([0, 1]);
                    yAxis.call(d3.axisLeft(yScale).ticks(5).tickFormat(d3.format("~s")));
                    return;
                }

                const mean = d3.mean(playgroundData);
                const mad = d3.mean(playgroundData, d => Math.abs(d - mean));
                const stddev = d3.deviation(playgroundData);
                const stderr = n > 1 && stddev ? stddev / Math.sqrt(n) : 0;
                const cv = mean !== 0 && stddev ? (stddev / mean) * 100 : 0;

                d3.select("#stat-mean").text(mean.toFixed(2));
                d3.select("#stat-mad").text(mad.toFixed(2));
                d3.select("#stat-stddev").text(stddev ? stddev.toFixed(2) : "N/A");
                d3.select("#stat-stderr").text(stderr ? stderr.toFixed(2) : "N/A");
                d3.select("#stat-cv").text(cv ? cv.toFixed(1) + "%" : "N/A");

                const histogram = d3.histogram().value(d => d).domain(xScale.domain()).thresholds(xScale.ticks(20));
                const bins = histogram(playgroundData);
                yScale.domain([0, d3.max(bins, d => d.length) || 1]);
                yAxis.transition().duration(200).call(d3.axisLeft(yScale).ticks(5).tickFormat(d3.format("~s")));
                barGroup.selectAll(".bar").data(bins).join(enter => enter.append("rect").attr("class", "bar").attr("x", d => xScale(d.x0) + 1).attr("y", height).attr("width", d => Math.max(0, xScale(d.x1) - xScale(d.x0) - 1)).attr("height", 0).attr("fill", "#007bff").call(enter => enter.transition().duration(300).attr("y", d => yScale(d.length)).attr("height", d => height - yScale(d.length))), update => update.call(update => update.transition().duration(300).attr("y", d => yScale(d.length)).attr("height", d => height - yScale(d.length))), exit => exit.call(exit => exit.transition().duration(200).attr("height", 0).attr("y", height).remove()));

                if (stddev && !isNaN(mean)) { // Check if mean and stddev are valid numbers
                    const sdLines = [
                        { val: mean, label: "Mean", color: "#dc3545", dy: -5 },
                        { val: mean + stddev, label: "+1 SD", color: "#6c757d", dy: -5 },
                        { val: mean - stddev, label: "-1 SD", color: "#6c757d", dy: 15 },
                        { val: mean + 2 * stddev, label: "+2 SD", color: "#adb5bd", dy: -5 },
                        { val: mean - 2 * stddev, label: "-2 SD", color: "#adb5bd", dy: 15 }
                    ];

                    sdLines.forEach(lineInfo => {
                        // Check if the value is within the chart bounds
                        if (lineInfo.val >= xScale.domain()[0] && lineInfo.val <= xScale.domain()[1]) {
                            annotationGroup.append("line")
                                .attr("class", "sd-line")
                                .attr("x1", xScale(lineInfo.val))
                                .attr("y1", 0)
                                .attr("x2", xScale(lineInfo.val))
                                .attr("y2", height)
                                .attr("stroke", lineInfo.color)
                                .attr("stroke-width", lineInfo.label === "Mean" ? 2 : 1)
                                .attr("stroke-dasharray", lineInfo.label === "Mean" ? "none" : "4 2");

                            annotationGroup.append("text")
                                .attr("class", "sd-label")
                                .attr("x", xScale(lineInfo.val))
                                .attr("y", height)
                                .attr("dy", lineInfo.dy + 15)
                                .attr("text-anchor", "middle")
                                .style("fill", lineInfo.color)
                                .text(lineInfo.label);
                        }
                    });
                }
            }
            updatePlayground();
        })();

        (function setupSimulations() {
            const simSelect = d3.select("#sim-select"); const simN = d3.select("#sim-n"); const runBtn = d3.select("#run-simulation-btn"); const dataDisplay = d3.select("#simulation-data-display"); const margin = { top: 20, right: 20, bottom: 40, left: 40 }; const width = 600 - margin.left - margin.right; const height = 300 - margin.top - margin.bottom;
            const svg = d3.select("#simulation-plot").append("svg").attr("width", "100%").attr("height", height + margin.top + margin.bottom).attr("viewBox", `0 0 ${width + margin.left + margin.right} ${height + margin.top + margin.bottom}`).attr("preserveAspectRatio", "xMidYMid meet").append("g").attr("transform", `translate(${margin.left}, ${margin.top})`);
            const xScale = d3.scaleBand().range([0, width]).padding(0.1); const xAxis = svg.append("g").attr("transform", `translate(0, ${height})`);
            const yScale = d3.scaleLinear().range([height, 0]); const yAxis = svg.append("g");
            const barGroupSim = svg.append("g").attr("class", "bars-sim");
            const annotationGroupSim = svg.append("g").attr("class", "annotations-sim");

            runBtn.on("click", () => {
                const simType = simSelect.property("value"); const n = +simN.property("value");
                let data = []; let isCategorical = false; let domain = [];
                let mean = null; let stddev = null;

                if (simType === 'coin') { data = d3.range(n).map(() => Math.random() < 0.5 ? "Heads" : "Tails"); isCategorical = true; domain = ["Heads", "Tails"]; }
                else if (simType === 'die') { data = d3.range(n).map(() => Math.floor(Math.random() * 6) + 1); isCategorical = true; domain = [1, 2, 3, 4, 5, 6]; mean = d3.mean(data); stddev = d3.deviation(data); }

                dataDisplay.text(data.slice(0, 50).join(", ") + (data.length > 50 ? " ..." : ""));
                d3.select("#sim-stat-count").text(n);
                d3.select("#sim-stat-mean").text(mean !== null ? mean.toFixed(2) : "N/A");
                d3.select("#sim-stat-stddev").text(stddev ? stddev.toFixed(2) : "N/A");

                const counts = d3.rollup(data, v => v.length, d => d);
                const countData = domain.map(key => ({ key: key, value: counts.get(key) || 0 }));

                xScale.domain(domain);
                yScale.domain([0, d3.max(countData, d => d.value) || 1]);

                xAxis.transition().duration(200).call(d3.axisBottom(xScale));
                yAxis.transition().duration(200).call(d3.axisLeft(yScale).ticks(5).tickFormat(d3.format("~s")));

                barGroupSim.selectAll(".bar").data(countData, d => d.key).join(enter => enter.append("rect").attr("class", "bar").attr("x", d => xScale(d.key)).attr("y", height).attr("width", xScale.bandwidth()).attr("height", 0).attr("fill", "#28a745").call(enter => enter.transition().duration(300).attr("y", d => yScale(d.value)).attr("height", d => height - yScale(d.value))), update => update.call(update => update.transition().duration(300).attr("y", d => yScale(d.value)).attr("height", d => height - yScale(d.value))), exit => exit.call(exit => exit.transition().duration(200).attr("height", 0).attr("y", height).remove()));

                annotationGroupSim.html("");
                if (simType === 'die' && stddev && !isNaN(mean)) {
                    const xNumScale = d3.scaleLinear().domain([0.5, 6.5]).range([0, width]);

                    // ★★★ STYLE UPDATE ★★★
                    const sdLines = [
                        { val: mean, label: "Mean", color: "#e63946", dy: -5, dash: "none", width: 2 }, // Bright solid red
                        { val: mean + stddev, label: "+1 SD", color: "#457b9d", dy: -5, dash: "4 2", width: 1.5 }, // Dashed blue-grey
                        { val: mean - stddev, label: "-1 SD", color: "#457b9d", dy: 15, dash: "4 2", width: 1.5 } // Dashed blue-grey
                    ];

                    sdLines.forEach(lineInfo => {
                        if (lineInfo.val >= xNumScale.domain()[0] && lineInfo.val <= xNumScale.domain()[1]) {
                            annotationGroupSim.append("line").attr("class", "sd-line")
                                .attr("x1", xNumScale(lineInfo.val)).attr("y1", 0)
                                .attr("x2", xNumScale(lineInfo.val)).attr("y2", height)
                                .attr("stroke", lineInfo.color)
                                .attr("stroke-width", lineInfo.width) // Use width
                                .attr("stroke-dasharray", lineInfo.dash); // Use dash

                            annotationGroupSim.append("text").attr("class", "sd-label")
                                .attr("x", xNumScale(lineInfo.val)).attr("y", height)
                                .attr("dy", lineInfo.dy + 15).attr("text-anchor", "middle")
                                .style("fill", lineInfo.color).text(lineInfo.label);
                        }
                    });
                }
            });

            xScale.domain([]); yScale.domain([0, 1]); xAxis.call(d3.axisBottom(xScale)); yAxis.call(d3.axisLeft(yScale).ticks(5));
        })();
    </script>

</body>
</html>